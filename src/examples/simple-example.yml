description: >
  Simple example where Terraform and Cloudrail are used.

usage:
  version: 2.1
  orbs:
    cloudrail: indeni/cloudrail@1.4.0
  jobs:
    your_job:
      docker:
        - image: hashicorp/terraform:latest
      steps:
        - checkout
        - terraform init
        - terraform plan -out terraform.plan
        - persist_to_workspace:
            root: .
            paths:
              - ./
  workflows:
    use_cloudrail:
      jobs:
        - your_job
        - cloudrail/scan_terraform:
            cloudrail_api_key: my_key
            cloud-account-id: "123456789012"
            tf_directory: /tmp/workspace/
            plan_output_file: /tmp/workspace/terraform.plan
            pre-steps:
              - attach_workspace:
                at: /tmp/workspace
